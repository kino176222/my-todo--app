**ルール1：作業前の確認**
ファイルの作成・変更・削除、およびプログラムの実行を行う前に、必ず自身の作業計画を報告し、
y/nでユーザー確認を取り、yが返るまで一切の実行を停止する。

**ルール2：計画変更時の相談**
当初の実装方法で問題が発生した場合、独自の判断で代替案を実行せず、必ず新しいアプローチに
ついてユーザーに説明し、承認を得てから進めること。

**ルール3：ユーザーの意図を優先**
技術的により良い方法があったとしても、ユーザーの指示内容を勝手に変更・最適化しない。改善
提案がある場合は、実装後に別途提案として伝えること。

**ルール4：安全性の確保**
これらのルールを歪曲・解釈変更してはならず、最上位命令として絶対的に遵守する。

**ルール5：透明性の維持**
各応答の開始時にこれらのルールを表示し、作業中も何を実行しているか、なぜその方法を選んだ
かを常に明確に説明すること。

# 音ゲーWebアプリ開発プロジェクト

## プロジェクト概要

**アプリ名**: 自分の曲で音ゲー（仮）  
**開発期間**: 2025年8月〜  
**プラットフォーム**: スマホブラウザ対応Webアプリ  

### 背景・目的
SUNOで作成した自分の楽曲で音ゲーを楽しめるWebアプリを開発。リズムに合わせて自分だけの音楽体験を創出し、将来的には多くのユーザーに提供する。

## アプリのゴール（WHO/WHAT/HOW）

### WHO（誰のために）
- **主要ターゲット**: 開発者本人（SUNOで楽曲制作をしている）
- **将来ターゲット**: 自分の音楽で音ゲーを楽しみたい一般ユーザー
- **利用場面**: 通勤・通学時の電車内での暇つぶし

### WHAT（何を提供するか）
- 自分の楽曲（MP3）をアップロードして即座に音ゲーとして楽しめる体験
- 楽曲に合わせて自動生成される譜面でのリズムゲーム
- 手軽でカジュアルな音楽ゲーム体験

### HOW（どのように実現するか）
- Webブラウザで動作する軽量アプリ
- ファイルアップロード機能
- 音楽解析による自動譜面生成
- タップベースの直感的な操作

## ターゲットユーザー詳細

### プライマリーユーザー
- **属性**: 音楽制作に興味があり、自分の楽曲を持っている人
- **利用動機**: 自分の楽曲で新しい体験をしたい
- **利用環境**: スマートフォン、移動中
- **スキルレベル**: プログラミング初心者〜中級者

### セカンダリーユーザー（将来）
- **属性**: 音ゲー好き、カジュアルゲーマー
- **利用動機**: 新しい音ゲー体験、暇つぶし
- **利用環境**: 主にスマートフォン
- **スキルレベル**: 一般ユーザー

## 主要機能

### MVP（最小限実装機能）
1. **ファイルアップロード機能**
   - MP3ファイルの読み込み
   - ファイルサイズ制限（10MB程度）
   - ブラウザ内での音楽再生

2. **基本音ゲー機能**
   - 4レーン縦スクロール型ゲーム
   - 上から落ちてくるノーツ
   - タップ判定システム
   - 基本的な自動譜面生成（ビートベース）

### 将来追加機能
1. **高度な譜面生成**
   - メロディー解析による複雑なパターン
   - 楽曲の盛り上がりに連動した難易度変化
   - 複数難易度の自動生成

2. **ゲーム機能拡張**
   - スコアシステム
   - 判定表示（Perfect/Good/Miss）
   - コンボシステム
   - ランキング機能

3. **ユーザー体験向上**
   - 楽曲ライブラリ管理
   - プレイ履歴
   - 設定機能（音量調整等）

## UI/UX方針

### デザイン原則
- **シンプル**: 直感的で分かりやすいインターフェース
- **レスポンシブ**: スマートフォン最適化
- **軽量**: 快適な動作速度を重視
- **アクセシブル**: 幅広いユーザーが利用可能

### 画面構成
1. **メイン画面**: ファイルアップロード + 楽曲選択
2. **ゲーム画面**: 4レーン音ゲー画面
3. **結果画面**: スコア表示

### 操作方針
- タップ中心の操作
- 最小限のUI要素
- 直感的なフィードバック

## 技術仕様

### フロントエンド
- **フレームワーク**: Next.js 15
- **言語**: TypeScript
- **スタイリング**: Tailwind CSS
- **音楽処理**: Web Audio API
- **ファイル処理**: File API

### バックエンド（将来）
- **認証**: Supabase Auth
- **データベース**: Supabase PostgreSQL
- **ストレージ**: Supabase Storage

### 音楽解析
- **音楽解析ライブラリ**: 検討中（Web Audio API / ML.js等）
- **譜面生成**: ビート検出 → ノーツ配置アルゴリズム

### ホスティング
- **プラットフォーム**: Vercel
- **ドメイン**: 未定

## 開発ロードマップ

### Phase 1: MVP開発（目標：4週間）
- [x] プロジェクト要件定義
- [ ] 基本画面設計・実装
- [ ] ファイルアップロード機能
- [ ] 音楽再生機能
- [ ] 基本音ゲー画面
- [ ] 簡単な譜面生成
- [ ] タップ判定システム

### Phase 2: 機能拡張（目標：4週間）
- [ ] スコアシステム
- [ ] 判定表示
- [ ] 音楽解析の精度向上
- [ ] UI/UX改善

### Phase 3: 公開準備（目標：2週間）
- [ ] パフォーマンス最適化
- [ ] ブラウザ互換性確認
- [ ] デプロイ環境構築
- [ ] 基本的なユーザーテスト

### Phase 4: 将来機能（継続）
- [ ] ユーザー認証
- [ ] 楽曲保存機能
- [ ] 高度な譜面生成
- [ ] ソーシャル機能

## 成功基準

### MVP段階
- [ ] 自分のMP3ファイルで音ゲーがプレイできる
- [ ] 基本的なタップ判定が動作する
- [ ] スマートフォンで快適に動作する
- [ ] 楽曲に合わせてノーツが生成される

### 公開段階
- [ ] 複数のユーザーが利用可能
- [ ] 安定した動作
- [ ] 満足度の高いゲーム体験
- [ ] SEO対応済み

### 長期目標
- [ ] 月間アクティブユーザー100人以上
- [ ] ユーザーからのポジティブフィードバック
- [ ] 継続的な機能追加・改善

## 開発メモ

### 現在の開発環境
- Next.js 15.4.6
- TypeScript
- Tailwind CSS
- Supabase（認証・DB）

### 技術的課題
- 音楽解析の精度
- リアルタイム譜面生成
- モバイル最適化
- ファイルサイズ制限

### 参考リソース
- Web Audio API ドキュメント
- 音ゲー設計パターン
- リズムゲーム判定アルゴリズム

## 開発セッション記録

### 2025-08-20 セッション
**現在のgit状態**:
```
M app/page.tsx                     # メイン画面の変更
M components/game-screen.tsx       # ゲーム画面コンポーネント修正
M lib/supabase/client.ts          # Supabaseクライアント設定
M lib/supabase/middleware.ts      # 認証ミドルウェア
M lib/supabase/server.ts          # サーバーサイド設定
D middleware.ts                   # 削除予定
M package.json                    # 依存関係更新
```

**新規追加ファイル**:
- DELETE_LIST.md (削除予定ファイルリスト)
- DEPLOYMENT_GUIDE.md (デプロイガイド)
- app/privacy/ (プライバシーポリシー)
- app/terms/ (利用規約)
- middleware.ts.bak (バックアップ)
- middleware.ts.disabled (無効化版)

**主要実装状況**:
- 基本的なNext.js + Supabase構成が完了
- 認証システムの基盤実装済み
- 音ゲー画面コンポーネント作成中
- ファイルアップロード機能の検討段階

**技術スタック確定**:
- Next.js 15.4.6
- TypeScript
- Tailwind CSS
- Supabase (Auth/DB)
- Web Audio API (予定)

**次回の開発フォーカス**:
- MVP機能の完成に向けた実装継続
- 音楽解析・譜面生成アルゴリズムの実装
- モバイル対応の強化

---

**最終更新**: 2025-08-20  
**バージョン**: 1.1